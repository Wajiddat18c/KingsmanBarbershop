<div class="col-md-6">
    <h3>Tilføj produkter(Valgfrit):</h3>
    <p id="errormsg" style="display: none;" class="alert alert-warning"></p>
    <form action="/booking_dates" method="POST">
      <br/>
      <div>
        <p>Produkter (Valgfrit):</p>
        <div id="productList"></div>
    </div>
      <br />
      <button type="submit" class="btn btn-primary">Fortsæt</button>
      <script>
          const products = async () => {
            let response = await fetch("/products");
            return await response.json();
        };
        products().then((values) => {
            for (let i in values) {
                let val = values[i];
                document.getElementById("productList").innerHTML +=
                    `<div>
                        <input type="checkbox" name="products" value=' {"id": ${val.id}, "name": "${val.name}", "price": "${val.price}", "count": 1} '>
                        <span>
                            ${val.name} - ${val.price} kr,-
                        </span>
                        <span>
                            antal:
                        </span>
                        <select name="count" class="count">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>`;
            }$(".count").change(function(e){
                    const prod = e.target.parentElement.childNodes[1];
                    
                    obj_to_change = JSON.parse(prod.value);
                    obj_to_change.count = e.target.value
                    //console.log(obj_to_change);
                    prod.value = JSON.stringify(obj_to_change);
                });
            $(() => {
                
            })
        }, (reject) => {
            console.log(`Products weren't received correctly, error: ${reject}`);
        })
          if(document.getElementById("error").value)
          {
              document.getElementById("errormsg").innerText = document.getElementById("error").value;
              document.getElementById("errormsg").style = "";
          }
      </script>
    </form>
  </div>
  